{% extends 'base.html' %}

{% block title %}
  Homepage
{% endblock %}

{% block content %}
  <!-- Hero Section -->
  <section class="text-center py-16 bg-white shadow">
    <h2 class="text-4xl font-bold text-gray-800">Book Your Study Room</h2>
    {% if user.is_authenticated %}
      <p class="mt-4 text-gray-600">Hi, {{ request.user.first_name|default:request.user.username }}</p>
    {% else %}
      <p class="mt-4 text-gray-600">Login to reserve a room {{ request.user.first_name|default:request.user.username }}</p>
    {% endif %}
  </section>

  {% if messages %}
    <div class="max-w-4xl mx-auto mt-4">
      {% for message in messages %}
        <div class="p-3 rounded-lg mb-2 shadow-md
        {% if message.tags == 'success' %}
            
             bg-green-100 text-green-800 border border-green-300


          {% elif message.tags == 'error' %}
            
             bg-red-100 text-red-800 border border-red-300


          {% else %}
            
             bg-gray-100 text-gray-800 border border-gray-300

          {% endif %}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Date Picker -->
  <section class="max-w-6xl mx-auto py-6">
    <form method="get" class="flex items-center space-x-4">
      <label for="date" class="font-medium text-gray-700">Select Date:</label>
      <input type="date" id="date" name="date" value="{{ selected_date|date:'Y-m-d' }}" min="{{ today|date:'Y-m-d' }}" max="{{ max_date|date:'Y-m-d' }}" class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-700" />
      <button type="submit" class="bg-red-700 text-white px-4 py-2 rounded-lg hover:bg-red-800">Show</button>
    </form>
  </section>

  <!-- Rooms Section -->
  <section id="rooms" class="max-w-6xl mx-auto py-12">
    <h3 class="text-2xl font-semibold mb-6">Available Rooms for {{ selected_date|date:'F j, Y' }}</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {% for room in rooms %}
        <div class="bg-white rounded-2xl shadow p-6">
          <h4 class="text-xl font-bold">{{ room.name }} ({{ room.number }})</h4>
          <p class="text-gray-600 mt-2">{{ room.capacity }} people</p>

          {% if room.is_closed %}
            <div class="mt-4 p-3 bg-red-100 text-red-800 rounded-lg border border-red-300">
              This room is currently <strong>not available</strong>.
            </div>
          {% else %}
            <div class="mt-4 space-y-3">
            {% for session in room.sessions %}
              <div class="flex justify-between items-center">
                <span class="font-medium">{{ session.label }}</span>
                {% if session.is_booked %}
                  <button class="bg-gray-400 text-white px-3 py-1 rounded cursor-not-allowed">Booked</button>
                {% else %}
                  {% if user.is_authenticated %}
                    <form method="post">
                      {% csrf_token %}
                      <input type="hidden" name="room_id" value="{{ room.id }}" />
                      <input type="hidden" name="date" value="{{ selected_date|date:'Y-m-d' }}" />
                      <input type="hidden" name="session" value="{{ session.id }}" />
                      <button type="submit" class="bg-red-700 text-white px-3 py-1 rounded hover:bg-red-800" onclick="return confirm('Are you sure you want to book this room?');">Book</button>
                    </form>
                  {% else %}
                    <a href="{% url 'booking:login' %}" class="bg-red-700 text-white px-3 py-1 rounded hover:bg-red-800">Login</a>
                  {% endif %}
                {% endif %}
              </div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </section>
{% endblock %}
